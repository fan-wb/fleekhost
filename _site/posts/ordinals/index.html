<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Ordinals &amp; BRC-20 技术原理详解" />
<meta property="og:locale" content="en" />
<meta name="description" content="本文从技术的角度出发，深入底层，详细介绍了比特币 Ordinals 协议以及 BRC-20 代币标准的原理。主要内容包括 Colored Coins 项目介绍、SegWit 与 Taproot 升级详解、序数铭文及 BRC-20 代币标准说明。" />
<meta property="og:description" content="本文从技术的角度出发，深入底层，详细介绍了比特币 Ordinals 协议以及 BRC-20 代币标准的原理。主要内容包括 Colored Coins 项目介绍、SegWit 与 Taproot 升级详解、序数铭文及 BRC-20 代币标准说明。" />
<link rel="canonical" href="https://fan-wb.github.io/posts/ordinals/" />
<meta property="og:url" content="https://fan-wb.github.io/posts/ordinals/" />
<meta property="og:site_name" content="Fanwb’s Blog" />
<meta property="og:image" content="https://fanwb.oss-cn-beijing.aliyuncs.com/img/ordi-1.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-11T13:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://fanwb.oss-cn-beijing.aliyuncs.com/img/ordi-1.jpg" />
<meta property="twitter:title" content="Ordinals &amp; BRC-20 技术原理详解" />
<meta name="twitter:site" content="@twitter_username" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-10-12T17:00:22+08:00","datePublished":"2024-01-11T13:00:00+08:00","description":"本文从技术的角度出发，深入底层，详细介绍了比特币 Ordinals 协议以及 BRC-20 代币标准的原理。主要内容包括 Colored Coins 项目介绍、SegWit 与 Taproot 升级详解、序数铭文及 BRC-20 代币标准说明。","headline":"Ordinals &amp; BRC-20 技术原理详解","image":"https://fanwb.oss-cn-beijing.aliyuncs.com/img/ordi-1.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://fan-wb.github.io/posts/ordinals/"},"url":"https://fan-wb.github.io/posts/ordinals/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Ordinals & BRC-20 技术原理详解 | Fanwb's Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Fanwb's Blog">
<meta name="application-name" content="Fanwb's Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    
      <link rel="preconnect" href="https://cdnjs.cloudflare.com" >
      <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/微信图片_20240125105358.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">Fanwb's Blog</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">The Revolution Will Be Decentralized.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tag"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/test/" class="nav-link">
            <i class="fa-fw fas fa-ghost"></i>
            

            <span>TEST</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/fan-wb"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/twitter_username"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-square-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['fanwb.eth','outlook.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Ordinals & BRC-20 技术原理详解</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Ordinals & BRC-20 技术原理详解</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1704949200"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jan 11, 2024
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1728723622"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Oct 12, 2024
</time>

        </span>
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/ordi-1.jpg" class="popup img-link preview-img shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/ordi-1.jpg"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/fan-wb">Fan-WB</a>
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="14026 words"
>
  <em>77 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <p>本文从技术的角度出发，深入底层，详细介绍了比特币 Ordinals 协议以及 BRC-20 代币标准的原理。主要内容包括 Colored Coins 项目介绍、SegWit 与 Taproot 升级详解、序数铭文及 BRC-20 代币标准说明。</p>

<h2 id="1-背景知识"><span class="me-2">1 背景知识</span><a href="#1-背景知识" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="11-比特币交易模型"><span class="me-2">1.1 比特币交易模型</span><a href="#11-比特币交易模型" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在比特币网络中，比特币的形式是“未花费交易输出” (Unspent Transaction Output, UTXO)，即比特币交易执行后形成的面额不定的单元，其原理可简单类比现实中的现金支付，与传统的基于账户余额的模型有所不同。举例而言：在银行的账户记账模型流程中，当 A 向 B 转账 100 元时，银行会记录三个步骤，这三个步骤构成了一个交易过程。第一步是从 A 的账户中扣除 100 元，这个步骤的记录 ID 为 tid1。第二步是将 100 元存入 B 的账户中，这个步骤的记录 ID 为 tid2。第三步是记录一笔转账记录，该记录将 tid1 和 tid2 关联起来，表示 A 账户减少 100 元，B 账户增加 100 元。这样，A 和 B 之间的转账关系就被记录了下来，并且可以在未来查询与追踪。</p>

<p>而在比特币区块链中，所有的余额都是存储在一个名为 UTXO 的列表中。每个 UTXO 都包含一定数量的比特币，以及这些比特币的所有者信息，并标明是否可用。可以将其想象成一张署有持有人姓名的现金支票，只要持有人在上面签名，就可以将使用权转让给他人。对于特定的地址，其所有的 UTXO 金额加起来即为该地址钱包的余额。通过遍历所有的 UTXO，我们可以获取每个地址的当前余额。将所有的 UTXO 金额加总，则为当前全部流通的比特币。</p>

<p>在比特币的交易结构中，每笔交易都包括若干个输入和输出，其中每个输入是对一个已有的 UTXO 的引用，而每个输出则指定了新的资金接收地址及相应的金额。一旦一笔交易被发起，其输入部分所引用的 UTXO 便会被暂时锁定，以防止在交易完成前被重复使用。只有当这笔交易成功地被矿工打包到一个区块并获得网络确认后，相关的 UTXO 状态才会发生变化。具体来说，用于交易输入的 UTXO 将从 UTXO 列表中移除，表示它们已经被消费，而交易的输出则会生成新的 UTXO，并添加到 UTXO 列表中。可以理解为，旧现金支票被使用后失效，产生了新现金支票，其所有权属于新的持有人。</p>

<p>值得强调的是，每个 UTXO 只能在一笔交易中被使用一次。一旦它作为输入被消费，它就会永久地从 UTXO 列表中移除。同时，新生成的输出作为新的 UTXO 加入到列表中。UTXO 列表是不断变化的，随着每个新区块的创建，它会相应地进行更新。并且，通过分析区块链中的交易历史，我们能够重建在任何给定时间点的 UTXO 列表状态。</p>

<p>此外，一笔交易的总输入金额通常会略微超过其总输出金额。这个差额，称为交易费用 (Transaction fee)，是作为激励给予负责将交易打包到区块的矿工的。网络费的大小与交易的复杂性成正比，因此，一笔包含更多输入和输出的交易通常需要支付更高的网络费。</p>

<p>图1 是通过区块链浏览器展示交易信息的例子（假设场景为 Alice 使用了 0.1 BTC，其中的 0.015 BTC 转账给了 Bob 用于购买咖啡，而 0.0845 BTC 退给了自己，0.0005 BTC 是转账手续费，由打包者获得）。这个交易在主网上真实存在，参考： <a href="https://www.blockchain.com/btc/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2">0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2</a> 。</p>

<p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/1706166670236.png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/1706166670236.png" style="zoom:80%;" loading="lazy"></a>
<em>图1 交易信息</em></p>

<p>上图中是比较高层次的交易信息。使用 bitcoin-cli 子命令 <code class="language-plaintext highlighter-rouge">getrawtransaction</code> 和 <code class="language-plaintext highlighter-rouge">decoderawtransaction</code> ，可以得到上面 Tx 的底层结构如下：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"locktime"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"vin"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"txid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"vout"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"scriptSig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"sequence"</span><span class="p">:</span><span class="w"> </span><span class="mi">4294967295</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"vout"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01500000</span><span class="p">,</span><span class="w">
            </span><span class="nl">"scriptPubKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.08450000</span><span class="p">,</span><span class="w">
            </span><span class="nl">"scriptPubKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"</span><span class="p">,</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>可以看到交易中有 Input 和 Output（分别是上面的 vin 和 vout）。Input 标识哪个 UTXO 将被消费，并通过解锁脚本提供所有权证明。Output 则创建新的 UTXO 比特币块并用锁定脚本锁定，供所有者在未来交易中使用。</p>

<p><strong>比特币网络中交易输出有两个重要信息：地址（公钥哈希）和 value（比特币）。如果交易的输出没有出现在其它交易的输入中，则这个 Tx 的输出就称为 UTXO（未花费交易输出）。</strong>谁拥有 UTXO 中公钥对应的私钥，谁就可以使用（即花费）这个 UTXO。</p>

<p>上例中交易的输入为：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="w">     </span><span class="nl">"vin"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"txid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"vout"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"scriptSig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"sequence"</span><span class="p">:</span><span class="w"> </span><span class="mi">4294967295</span><span class="w">
        </span><span class="p">}</span><span class="w">
     </span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>表示这个 Tx 所花费的 UTXO 来自于另外一个 Tx（其 id 为 <a href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18">7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18</a>）的第 0 个输出（一个 Tx 的输出可以有多个，索引从 0 开始编号），我们可以从历史 Tx 中查找出这个 UTXO 的 value（比如为 0.1），所以这个 Tx 中 Alice 花费了 0.1 BTC，数值 0.1 不需要显式地写在 Tx 中，而是通过查找 UTXO 信息来得到的。</p>

<p>一旦这个 Tx 被提交，那么 Tx（<a href="https://www.blockchain.com/btc/tx/7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18">7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18</a>）的第 0 个输出就不再是 UTXO 了。</p>

<p>这个 Tx 中，输出有两个条目，如下所示：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="w">    </span><span class="nl">"vout"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01500000</span><span class="p">,</span><span class="w">
            </span><span class="nl">"scriptPubKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.08450000</span><span class="p">,</span><span class="w">
            </span><span class="nl">"scriptPubKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"</span><span class="p">,</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>这两个条目刚开始都是 UTXO，直到有另外的 Tx 把它们作为输入花费掉为止。</p>

<p>发起⼀笔交易时，发送方在交易中放入 scriptPubKey，即上文提到的锁定脚本。接收方在花费时生成⼀个 scriptSig，即上文提到的解锁脚本，包含了满足 scriptPubKey 脚本的数据参数的集合。针对解锁的条件，可以将比特币交易分为多类，其中经典的两类是 P2PKH 和 P2SH。</p>

<p><strong>P2PKH</strong></p>

<p>Pay-to-PubKeyHash (P2PKH) 是⼀种传统的比特币交易，其地址以数字 1 开头。只有P2PKH 地址的所有者才能通过提供公钥哈希值和私钥签名来解锁 scriptPubKey 并花费其锁定的 UTXO。其中，私钥是用来证明公钥哈希值的所有权的。</p>

<p>如下图所示，发送交易时，发送方需要在交易中包含 scriptPubKey。当接收方想要解锁这笔 UTXO 时，需要执行下图中的比特币脚本，如果 PubKHash 相等，且签名验证通过，就可以成功解锁交易。P2PKH 的脚本会增加交易的体积，产⽣的交易费比普通交易⾼出 5 倍左右，且该成本由发送方承担。P2SH 可以帮助发送方免去这⼀额外成本。</p>

<p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/mbc2_0603.png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/mbc2_0603.png" style="zoom: 50%;" loading="lazy"></a>
<em>图2 P2PKH</em></p>

<p><strong>P2SH</strong></p>

<p>Pay-to-Script-Hash (P2SH) 可以帮助发送方免去额外成本，并将这⼀成本转移到真正需要使用锁定脚本中规定条件的接收方身上。P2SH 的比特币地址以数字 3 开头。</p>

<p>发送交易时，发送方不再需要将 scriptPubKey 放在交易中，而是将赎回脚本 (Redeem Script) 哈希值放在交易中。赎回脚本哈希值由赎回脚本计算得到，赎回脚本与 scriptPubKey 类似，包含接收方在花费 UTXO 之前必须满足的条件。</p>

<p>如下表所示，发送方只需在交易中注明赎回脚本的哈希值即可。而接收方想要解锁 UTXO 时，需要⽣成具有相同哈希值的赎回脚本并将其包含到交易内。因此，接收方用来解锁 UTXO 的交易大小会增加，执行交易的成本也会增加。</p>

<center>表1 P2SH复杂脚本</center>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Item</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Redeem Script</td>
      <td>2 PubKey1 PubKey2 PubKey3 PubKey4 PubKey5 5 CHECKMULTISIG</td>
    </tr>
    <tr>
      <td>Locking Script</td>
      <td>HASH160 &lt;20-byte hash of redeem script&gt; EQUAL</td>
    </tr>
    <tr>
      <td>Unlocking Script</td>
      <td>Sig1 Sig2 &lt; redeem script &gt;</td>
    </tr>
  </tbody>
</table></div>

<h3 id="12-比特币脚本"><span class="me-2">1.2 比特币脚本</span><a href="#12-比特币脚本" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>比特币中的脚本 (<a href="https://en.bitcoin.it/wiki/Script">Script</a>) 是一种简单的基于栈的、非图灵完备的语言。这里以 Pay-to-Public-Key-Hash (P2PKH) 类型的脚本为例进行说明。</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>scriptPubKey: OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
scriptSig: &lt;sig&gt; &lt;pubKey&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>为了解释得更清楚，原始的 scriptPubKey如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>  76       A9             14
OP_DUP OP_HASH160    Bytes to push

89 AB CD EF AB BA AB BA AB BA AB BA AB BA AB BA AB BA AB BA   88         AC
                      Data to push                     OP_EQUALVERIFY OP_CHECKSIG
</pre></td></tr></tbody></table></code></div></div>

<p>注意：scriptSig 在花费交易的输入中，主要包含转账的目标地址（公钥的 Hash）。而 scriptPubKey 在先前未花费交易（即“可用”交易）的输出中，主要包含签名和公钥（由此，我们可以利用公钥验证签名，从而确定用户身份）。</p>

<p>脚本处理过程如下：</p>

<center>表2 P2PKH流程说明</center>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: left">栈</th>
      <th style="text-align: left">脚本</th>
      <th style="text-align: left">说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">空</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;sig&gt; &lt;pubKey&gt; OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG</code></td>
      <td style="text-align: left">组合 scriptSig 和 scriptPubKey</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;sig&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubKey&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG</code></td>
      <td style="text-align: left">常量入栈</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;sig&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubKey&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubKey&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG</code></td>
      <td style="text-align: left">栈顶元素被复制</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;sig&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubKey&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubHashA&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG</code></td>
      <td style="text-align: left">计算栈顶元素的哈希</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;sig&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubKey&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubHashA&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubKeyHash&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">OP_EQUALVERIFY OP_CHECKSIG</code></td>
      <td style="text-align: left">常量入栈</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;sig&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubKey&gt;</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">OP_CHECKSIG</code></td>
      <td style="text-align: left">检查确认栈顶两元素相等</td>
    </tr>
    <tr>
      <td style="text-align: left">TRUE</td>
      <td style="text-align: left">空</td>
      <td style="text-align: left">使用栈顶两元素验证签名合法</td>
    </tr>
  </tbody>
</table></div>

<p>交易验证时，在栈上执行脚本，先执行交易输入中的 解锁脚本 (scriptSig)，再执行这个输入所引用的 UTXO 中的锁定脚本（scriptPubKey），如果最后栈中内容为 TRUE，则认为这个输入是合法的，如果所有的输入合法则整个交易通过验证。</p>

<h2 id="2-从历史出发colored-coins"><span class="me-2">2 从历史出发：Colored Coins</span><a href="#2-从历史出发colored-coins" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><strong>概述</strong></p>

<p>2012 年 12 ⽉ 4 ⽇，为了在比特币区块链上体现股票、房地产等实物资产，密码学家、数学家、以色列比特币协会主席 Meni Rosenfeld 发布了彩色币白皮书 <a href="https://docs.google.com/document/d/1AnkP_cVZTCMLIzw4DvsW6M8Q2JC0lIzrTLuoWu2z1BE/edit#heading=h.pr8n14cpqri5">Colored Coins whitepaper</a>。</p>

<p>比特币⾃设计之初就是同质的、可替代的，是⼀种中立的交换媒介。如果仔细追踪特定比特币的来源，可以将⼀组比特币 “<strong>上色</strong>” 成为彩色币，使其与其他比特币区分开来。这样，这些比特币就具备了非同质化特性，可以具有由发行机构或公共协议支持的特殊属性，并包含了独立于基础比特币面值的价值。这种彩色比特币可用于替代货币、商品证书、智能财产以及股票和债券等其他金融⼯具。</p>

<p>例如，假设有⼀家汽车租赁公司，通过发布⼀枚彩色币来代表⼀辆汽车，然后将汽车配置为只有在收到用当前拥有该彩色币的私钥签署的信息时才会解锁。然后，该公司可以发布⼀个智能⼿机应用程序，任何人都可以用它来广播⼀条用⾃己的私人密钥签名的信息，并将彩色币放到⼀个交易平台上。基于此，任何人都可以购买彩色币，使用智能⼿机应用程序作为“汽车钥匙”，在任何时间内使用汽车，并在闲暇时再次出售彩色币。</p>

<p><strong>实现</strong></p>

<p>从技术角度来说，彩色币是在创世交易（不同于创世区块中的创世交易）里面被转移过的比特币。要发行⼀种新颜色的彩色币，必须创建 “彩色地址” 并将其存储在由颜色感知客户端（例如 Coinprism、Coloredcoins、Colu 或CoinSpark）控制的 “彩色钱包” 中。彩色币创世交易的输入和输出必须遵循特定的规则。输出包括⼀组将彩色币发送给原始所有者的输出、⼀个 <code class="language-plaintext highlighter-rouge">OP_RETURN</code> 数据输出、⼀个或多个“找零”输出（即将多余的未着色比特币发送回发行者）。发行者可以选择发行 <strong>Non-reissuable colors</strong> 或者 <strong>Reissuable colors</strong>。</p>

<p><code class="language-plaintext highlighter-rouge">OP_RETURN</code> 输出允许有 40 字节（后来改为 80 字节）作为标准交易的⼀部分。所有标识为彩色比特币交易的数据都将包含在该数据字段中。彩色币本身就是比特币，存储和转移的逻辑与比特币⼀致。EPOBC 是彩色币的第⼀个实现。</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre># 彩色币的 OP_RETURN 数据定义
[0...4]: [0,67,67,80,0] (that’s “CCP” padded with a zero-byte on both sides)
[5...6]: protocol version number (currently 1)
[7...8]: reissuance policy (0 for non-reissuable, 65535 for infinitely reissuable from the genesis address)
[9..39]: optional (data about the color)
</pre></td></tr></tbody></table></code></div></div>

<p><strong>优缺点</strong></p>

<p>彩色币第⼀次为比特币引入了创新概念并扩大了比特币的用例，使比特币可被用于表示资产的数字化形式、开展去中心化交易以及作为资产管理和点对点交易的创新解决方案，并且仍然保持着透明度、可追踪性、去中心化等多个特性。</p>

<p>然而彩色币相对来说具有⼀定程度的复杂性，并且功能有限，无法很好地为现实世界的很多金融活动提供便利。例如，每笔交易都是可见的，可能并不适合所有类型的资产转移。另外，彩色币也面临着发行人不遵守相关义务的风险。</p>

<p><strong>对</strong> <strong>Colored Coins</strong> <strong>的更多思考</strong></p>

<p>虽然 <code class="language-plaintext highlighter-rouge">OP_RETURN</code> 是⼀个非常直接的用以存储信息至比特币区块链的⼿段，也是⼀个潜在的铭文方式。但是 <code class="language-plaintext highlighter-rouge">OP_RETURN</code> 的限制使得其在处理元数据存储时面临⼀些挑战。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">OP_RETURN</code> 只能存储非常有限的数据，对于需要存储更大量数据的情况来说，这种限制显然是无法满足的；</li>
  <li><code class="language-plaintext highlighter-rouge">OP_RETURN</code> 数据被存储在交易输出部分，虽然这种数据不存储在 UTXO 集中，但是它们占用了区块链的存储空间，导致区块链规模的增加。</li>
  <li>使用 <code class="language-plaintext highlighter-rouge">OP_RETURN</code> 会导致交易费用的提⾼，因为它需要支付更多的费用来发布这些交易。</li>
</ul>

<p>Colored Coins 的出现说明人们对比特币有着更丰富的需求，但是受限于当时的比特币基础设施不够完善，Colored Coins 并没有取得成功。为了让比特币具有更多的用法，需要提升比特币的效率、灵活性，并且赋予比特币更⾼级的脚本能力。</p>

<h2 id="3-比特币的两次升级"><span class="me-2">3 比特币的两次升级</span><a href="#3-比特币的两次升级" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="31-segwit"><span class="me-2">3.1 SegWit</span><a href="#31-segwit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>“隔离见证”（<a href="https://en.wikipedia.org/wiki/SegWit">Segregated Witness</a>，SegWit）是比特币的一个重要协议升级，由比特币核心开发者 Pieter Wuille 在 2015 年提出，最终在 2017 年的 0.16.0 版本中被正式采纳。</p>

<p>在密码学中，术语“见证” (Witness) 用于描述解决密码难题的方案。在比特币语境中，见证是指能够满足对 UTXO 施加的条件并解锁该 UTXO 以供花费的解决方案。“见证”是 “Unlocking Script” 或 “scriptSig” 更一般化的术语。</p>

<p>隔离见证，指的是把见证数据（即 scriptSig 中的内容）从交易信息里抽离出来，单独存放。 如图 3 所示。</p>

<p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/segwit-explained.webp" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/segwit-explained.webp" style="zoom: 60%;" loading="lazy"></a>
<em>图3 SegWit 区块说明</em></p>

<p>不使用隔离见证时，交易中包含了见证数据 (scriptSig)，也就是说见证数据 (scriptSig) 会影响 txid（txid 是 交易信息进行哈希运算后得到的一个唯一 id）；使用隔离见证后，交易中不再包含见证数据（scriptSig 总是为空），见证数据在另外的字段 (witness) 中（该字段不参与 txid 的计算）</p>

<p>SegWit 升级消除了比特币网络中的“交易延展性” (<a href="https://en.bitcoin.it/wiki/Transaction_malleability">Transaction Malleability</a>) 问题，同时优化了网络和存储，增加了比特币区块中能容纳的交易数量。</p>

<ul>
  <li>
    <p><strong>交易延展性问题</strong>：是指交易在被比特币网络确认之前，txid 可能被攻击者修改导致的问题，其根本原因是比特币交易中的签名数据是与交易的其余部分相关联的，⼀起进行哈希以产⽣交易的整体签名。这使得即使交易中的签名数据被更改，交易的有效性仍然可能保持不变。举例来说，Alice 提交了一个交易，转移一个 BTC 给 Bob，记为 tx1，这个交易的输入中 scriptSig 字段中包含了 Alice 的签名。在交易打包确认前，攻击者稍微调整 scriptSig，（比如在脚本末尾添加 <code class="language-plaintext highlighter-rouge">OP_PUSH</code> 和 <code class="language-plaintext highlighter-rouge">OP_DROP</code>，或者把签名换个 S 值）这些调整不会影响交易信息的签名验证，但会得到一个新 txid，记为 tx2。现在 tx1 和 tx2 都在等待打包确认状态。如果恰好 tx2 被先打包（这很少出现，但可以伪造更多的 tx3，tx4 来增加被先打包的概率），那么 tx1 在验证时就会失败，因为交易输入中引用的 UXTO 已经被 tx2 花费了。这样，Alice 成功转移了一个 BTC 给 Bob，但 txid 却不是 tx1 了。</p>

    <p>那么交易延展性带来的问题为什么不可接受呢？例如，假设 Alice 是交易所，而 Bob 是该交易所的用户。Bob 以前存入了 100 个 BTC，现在向 Alice 提出提币申请，Alice 向 Bob 转移 100 个 BTC，记下 txid 为 tx1，B 利用交易延展性，伪造了另外一个交易 tx2。这时恰好 tx2 被先打包了，tx1 失败。B 对 A 说“我没有收到 100 个 BTC”，A 去查询当时提交的 txid（即 tx1），发现确实 tx1 没有打包上链，然后再发起一个新交易，向 B 转移 100 BTC。这里，其实 A 已经向 B 转移了 200 BTC。</p>
  </li>
  <li>
    <p><strong>优化网络和存储</strong>：见证数据通常在交易的总大小中占了很大比重。更复杂的脚本，如用于多签或支付通道的脚本体积会非常大。在某些情况下，这些脚本会占到交易数据的大多数（超过 75%）。通过将见证数据从交易中移出，隔离见证提高了比特币的可扩展性。节点可以在验证签名后删减见证数据。见证数据不再需要发送到所有节点，也不需要被所有节点存储在磁盘上。同时，SetWit 升级还改变了区块大小的衡量方式，引入了“区块权重” (weight) 的概念，规定了见证数据的权重仅为交易数据权重的 25% 。这实际上意味着比特币区块大小增加了，并且在交易的 Witness 部分中存储数据变得更加便宜。例如，假设有⼀笔传统类型的交易，数据量大小为 200 Bytes。SegWit 升级前，1MB 的区块里面可以放进 5000 笔这样的交易。而⼀笔等效的 SegWit 交易有 120 Bytes 是放在 见证区域的，因此其加权大小为 80 + 0.25 *120 = 110 字节，所以区块可以放入 9090 笔这样的交易，容量几乎翻倍。</p>
  </li>
</ul>

<p>此外，SegWit 升级还有引入了两类支付脚本类型：P2WPKH 和 P2WSH 。</p>

<ul>
  <li>
    <p><strong>P2WPKH</strong> (Pay to Witness Public Key Hash)：</p>

    <p>P2WPKH 的交易输出脚本是⼀个包含公钥哈希的锁定脚本，公钥哈希是见证程序的哈希值。P2WPKH 的交易输出以 bc1 开头。</p>

    <p>前文 Alice 买咖啡的例子中，价值 0.015BTC 的 P2PKH 输出的锁定脚本如下：</p>

    <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG
</pre></td></tr></tbody></table></code></div>    </div>
    <p>而通过隔离见证，Alice 会创建一个“支付给见证公钥哈希” (P2WPKH) 脚本，如下：</p>

    <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>0 bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4
</pre></td></tr></tbody></table></code></div>    </div>
    <p>显然，隔离见证输出的锁定脚本比 P2PKH 的要简单得多。它包含两个值，第一个数字（0）是一个版本号，第二部分（20 字节）相当于一个锁定脚本，被称为见证程序（witness program）。这 20 字节的见证程序就像是 P2PKH 脚本中的公钥哈希值一样。</p>

    <p>主网上 P2WPKH 交易的实例，可参考：<a href="https://www.blockchain.com/btc/tx/ec9f03d79de1b408a2880e77b7be67c149ddb5e89c5b8c5a648fe29f4524d959">ec9f03d79de1b408a2880e77b7be67c149ddb5e89c5b8c5a648fe29f4524d959</a></p>
  </li>
  <li>
    <p><strong>P2WSH</strong>（Pay to Witness Script Hash）：</p>

    <p>P2WSH 对应 P2SH 脚本。P2WSH 的交易输出脚本是⼀个包含脚本哈希的锁定脚本，其中脚本哈希是一个由多个操作码组成的脚本的哈希值。</p>

    <p>一个这样的锁定脚本：</p>

    <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>OP_HASH160 54c557e07dde5bb6cb791c7a540e0a4796f5e97e EQUAL
</pre></td></tr></tbody></table></code></div>    </div>
    <p>使用隔离见证，可以创建一个如下的 P2WSH 输出进行付款：</p>
    <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>0 9592d601848d04b172905e0ddb0adde59f1590f1e553ffc81ddc4b0ed927dd73
</pre></td></tr></tbody></table></code></div>    </div>
    <p>显然，隔离见证等效脚本要简单得多，省略了 P2SH 脚本中的各种脚本操作符。而且，隔离见证程序仅包含两个推送到堆栈的值：一个见证版本（0），另一个为 32 字节的兑换脚本（Redeem Script）的哈希值。</p>
  </li>
</ul>

<p><strong>缺点</strong>：因为 SegWit 是⼀个软分叉，许多客户端可能不会升级，因此两种类型的 UTXO 会在网络中同时存在。SegWit 会降低网络的安全性，执行完全验证的节点会大幅减少，因为只有那些升级了的节点才有能力验证交易的 witness 部分。</p>

<p>总结来说，SegWit 升级把脚本签名（scriptSig）信息从区块中提取出来，放在⼀个新的数据结构当中。虽然见证数据不是为了数据存储而设计的，但实际上却给了用户⼀个存储其他类型数据内容的机会。</p>

<h3 id="32-taproot"><span class="me-2">3.2 Taproot</span><a href="#32-taproot" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>2021 年 11 月，比特币进行了 Taproot 软分叉升级，在区块 709632 处（2021 年 11 月 12 日）被激活。Taproot 升级由三个不同的比特币改进提案（BIP）组成：BIP 340、BIP 341 和 BIP 342 ，提升了比特币网络的可扩展性、隐私性和灵活性。而 Taproot 升级对后续铭文的影响主要体现在两个方面：<strong>更低的费用、更大的空间</strong>。</p>

<ul>
  <li>
    <p><strong>BIP 340</strong> 主要引入了 Schnorr 签名方案。相较于比特币使用的椭圆曲线数字签名算法（ECDSA），Schnorr 签名的主要优势在于，多重签名交易在链上呈现为普通的单一签名交易。使用Schnorr签名，多个签名者可以生成一个联合公钥，然后用一个签名共同签名，无需分别在区块链上发布每个公钥和每个签名。这就意味着 Schnorr 签名可实现显著的空间节省和验证时间节省，随着传统多重签名交易上签名者数量的增加，其比较优势变得更大。</p>
  </li>
  <li>
    <p><strong>BIP 341</strong> 包括两个技术升级：<strong>MAST</strong>（Merklized Abstract Syntax Tree，默克尔抽象语法树）和 <strong>P2TR</strong>（Pay-to-Taproot）。</p>

    <ul>
      <li>
        <p><strong>MAST</strong> 是比特币协议开发者 Dr. Johnson Lau 在2016年提出的一个概念。MAST 的理念是，交易可以包含多个花费条件，例如一个 2 对 2 的多重签名条件，以及一个时间锁条件。为了避免将所有这些条件和脚本都放入区块链，花费脚本可以被组织在一个 Merkle 树内，由此只需在使用时和必要的Merkle分支哈希一起被揭示即可。例如下图所示，要花费输出，签名者需要做的就是提供一个 Schnorr 多签和 Merkle 树右侧顶部的 Hash(1 &amp; 2)。因此，尽管存在Merkle树，在大多数情况下，只需要一个签名和 32 字节的哈希。</p>

        <p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/pasted image 0 (1).png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/pasted image 0 (1).png" style="zoom: 40%;" loading="lazy"></a>
<em>图4 MAST树</em></p>

        <p>然而，这种结构的缺点是，即使在正常的最佳情况下，当Merkle树左上方提供单个密钥和脚本时，仍然需要将另一个哈希发布到区块链（在上图中为Hash(1 &amp; 2)，使用了32字节的数据）。这同时也降低了隐私性，因为第三方可以据此确定是否存在更复杂的花费条件。</p>

        <p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/pasted image 1.png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/pasted image 1.png" style="zoom:40%;" loading="lazy"></a>
<em>图5 Taproot</em></p>

        <p>Taproot 在结构上与 MAST 相似，只是在 Merkle 树的顶部有所不同。在 Taproot 中，用户通过发布公钥签名或满足默克尔树中包含的脚本之⼀来花费，前者称为<strong>密钥路径花费</strong>（Key Path），后者则是 <strong>脚本路径花费</strong>（Script Path）。用户可以选择只公布单个公钥和单个签名，而无需公布 Merkle 树的存在。如图 5 所示，左侧调整后的公钥可以从原始公钥和 Merkel 根哈希计算得出。在正常情况下，赎回时不需要在链上保留原始公钥，也不需要揭示 Merkle 树的存在，只需要发布一个单一的签名。与原始 MAST 结构相比，Taproot无需在区块链或脚本本身中包含额外的 32 字节哈希，提高了效率。除此之外，Taproot 使交易看起来很正常，只是一个带有公钥和签名的支付，其他花费条件的存在不会被公布，因此能更好地保护隐私。</p>
      </li>
      <li>
        <p><strong>P2TR</strong>，即 Taproot Output ，是版本为 1 的隔离见证输出。P2TR 统一了 P2WPKH 和 P2WSH 这两类版本为 0 的隔离见证输出，也就是说其输出 的 scriptPubKey 字段是一样的，更有利于隐私保护。下表 是 P2WPKH/P2WSH/P2TR 的 scriptPubKey 字段及花费它们时的 Witness 字段的总结。</p>

        <center>表3 P2WPKH/P2WSH/P2TR对比</center>

        <div class="table-wrapper"><table>
          <thead>
            <tr>
              <th style="text-align: left">Type</th>
              <th style="text-align: left">scriptPubKey（锁定时使用）</th>
              <th style="text-align: left">Witness（花费时使用）</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="text-align: left">P2WPKH</td>
              <td style="text-align: left">0x0014{20-byte-key-hash}</td>
              <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;signature&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;pubkey&gt;</code></td>
            </tr>
            <tr>
              <td style="text-align: left">P2WSH</td>
              <td style="text-align: left">0x0020{32-byte-hash}</td>
              <td style="text-align: left">……</td>
            </tr>
            <tr>
              <td style="text-align: left">P2TR (Key Path)</td>
              <td style="text-align: left">0x5120{32-byte-tweaked-public-key}</td>
              <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;schnorr-signature&gt;</code></td>
            </tr>
            <tr>
              <td style="text-align: left">P2TR (Script Path)</td>
              <td style="text-align: left">0x5120{32-byte-tweaked-public-key}</td>
              <td style="text-align: left">…… <code class="language-plaintext highlighter-rouge">&lt;script&gt;</code> <code class="language-plaintext highlighter-rouge">&lt;control-blok&gt;</code></td>
            </tr>
          </tbody>
        </table></div>

        <p>从表中，可以看到创建一个 P2TR (Key Path) 输出时，要比创建 P2WPKH 输出要多占用更大的空间，因为 P2TR (Key Path) 的 scriptPubKey 直接含有 tweaked public key（32 字节），而 P2WPKH 则是公钥哈希（20 字节）。也就是说， 往 P2TR 转账比往 P2WPKH 地址转账要略微贵一点。</p>

        <p>不过， 花费 P2TR (Key Path) 比花费 P2WPKH 要省更多的费用， 原因有：</p>

        <ul>
          <li>花费 P2TR (Key Path) 的 Witness 中不再包含公钥；</li>
          <li>P2TR (Key Path) 采用的 Schnorr 签名比 P2WPKH 采用的 DER 格式的 ECDSA 签名要更小。</li>
        </ul>

        <p>综合考虑创建输出和花费输出两方面，P2TR (Key Path) 比 P2WPKH 更省费用。直观对比 P2WPKH 和 P2TR（Key Path）的 Witness：</p>

        <ul>
          <li>
            <p>P2WPKH 的 Witness 由“signature”和“pubkey”两个元素组成。</p>

            <p>Tx <a href="https://blockchain.info/rawtx/9d86b83297aaf232446e5ab41b603027fb37ad85f5259b78d6ff6fefe7cada9d">9d86b83297aaf232446e5ab41b603027fb37ad85f5259b78d6ff6fefe7cada9d</a> 是花费 P2WPKH 的例子，它的 Witness 为：</p>
            <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>0070: 02 .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. vin0 Witness Count: 2
0070: .. 48 .. .. .. .. .. .. .. .. .. .. .. .. .. .. DER vin0 Witness 0 Length:72
0070: .. .. 30 .. .. .. .. .. .. .. .. .. .. .. .. .. DER start
0070: .. .. .. 45 .. .. .. .. .. .. .. .. .. .. .. .. DER length: 69
0070: .. .. .. .. 02 .. .. .. .. .. .. .. .. .. .. .. DER int
0070: .. .. .. .. .. 21 .. .. .. .. .. .. .. .. .. .. DER R length: 33
0070: .. .. .. .. .. .. 00 f1 62 2d 41 47 f1 85 6c ad
0080: c3 12 df 06 6e 5a 19 b3 82 b2 0a 45 d6 a1 6e fb
0090: f9 12 b9 4e ac 5e bb .. .. .. .. .. .. .. .. .. DER R: 00f1622d4147f1856cadc312df066e5a19b382b20a45d6a16efbf912b94eac5ebb
0090: .. .. .. .. .. .. .. 02 .. .. .. .. .. .. .. .. DER int
0090: .. .. .. .. .. .. .. .. 20 .. .. .. .. .. .. .. DER S length: 32
0090: .. .. .. .. .. .. .. .. .. 36 cf e4 f3 a1 e2 34
00a0: 2c 18 5a a0 16 8d be 0e 38 8c 31 99 d6 d0 d7 4d
00b0: ed 41 4b c3 78 7e 41 66 9f .. .. .. .. .. .. .. DER S: 36cfe4f3a1e2342c185aa0168dbe0e388c3199d6d0d74ded414bc3787e41669f
00b0: .. .. .. .. .. .. .. .. .. 01 .. .. .. .. .. .. DER sighash type byte: 1
00b0: .. .. .. .. .. .. .. .. .. .. 21 02 cd cf e7 b2
00c0: fa cd 6a 06 8f a0 fb 0a c5 aa 02 fe e4 09 95 ef
00d0: 6a 7b d0 6a 54 d6 c7 58 98 8a d8 fa
</pre></td></tr></tbody></table></code></div>            </div>
          </li>
          <li>
            <p>P2TR（Key Path）的 Witness 只包含一个元素</p>

            <p>Tx <a href="https://blockchain.info/rawtx/dbef583962e13e365a2069d451937a6de3c2a86149dc6a4ac0d84ab450509c91">dbef583962e13e365a2069d451937a6de3c2a86149dc6a4ac0d84ab450509c91</a> 是花费 P2TR (Key Path) 的例子，它的 Witness 为：</p>

            <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>0050: .. 01 .. .. .. .. .. .. .. .. .. .. .. .. .. .. vin0 Witness Count: 1
0050: .. .. 41 .. .. .. .. .. .. .. .. .. .. .. .. .. vin0 Witness 0 Length:65, schnorr_sig (64 bytes) + sig_hash (1 bytes)
0050: .. .. .. e6 e1 fe 41 52 4e 65 e3 04 0b c3 d0 80 schnorr_sig
0060: a1 36 34 5c 2c 80 6e b7 f3 36 dd 6a 7a 79 e9 05
0070: 4b 0d 1f c6 a8 d8 36 66 7e f6 e9 f2 18 8c d1 27
0080: 0a b2 8e 5e 0e b6 42 ea c8 9f 2e c5 0a 32 ca 54
0090: aa f9 d6
0090: .. .. .. 01                                     sig_hash: SIGHASH_ALL (0x01)
</pre></td></tr></tbody></table></code></div>            </div>

            <p><em>*上面例子中 signature 占 65 字节。当 sig_hash 为 SIGHASH_DEFAULT（0x00）时，sig_hash 可以省略，这时 signature 只占 64 字节，比如<a href="https://hashxp.org/37777defed8717c581b4c0509329550e344bdc14ac38f71fc050096887e535c8#hwitness0">37777defed8717c581b4c0509329550e344bdc14ac38f71fc050096887e535c8</a> 首个输入就是 signature 只占 64 字节的例子。</em></p>
          </li>
          <li>
            <p>如果在花费 P2TR UTXO 时，Witness 至少包含两个元素，则是 P2TR (Script Path)，即通过 Witness 中元素的个数来决定使用 Key Path（Witness 元素个数为 1）还是 Script Path（Witness 元素个数大于等于 2）。</p>

            <p>Tx <a href="https://blockchain.info/rawtx/905ecdf95a84804b192f4dc221cfed4d77959b81ed66013a7e41a6e61e7ed530">905ecdf95a84804b192f4dc221cfed4d77959b81ed66013a7e41a6e61e7ed530</a> 是花费 P2TR (Script Path) 的例子（它是一个 2-of-2 多签脚本），它的 Witness 为：</p>

            <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>0070: .. .. .. .. .. .. 04 .. .. .. .. .. .. .. .. .. vin0 Witness Count: 4
0070: .. .. .. .. .. .. .. 41 23 b1 d4 ff 27 b1 6a f4 vin0 Witness 0 Length:65 (0x41)
0080: b0 fc b9 67 2d f6 71 70 1a 1a 7f 5a 6b b7 35 2b
0090: 05 1f 46 1e db c6 14 aa 60 68 b3 e5 31 3a 17 4f
00a0: 90 f3 d9 5d c4 e0 6f 69 be bd 9c f5 a3 09 8f de
00b0: 03 4b 01 e6 9e 8e 78 89 01 .. .. .. .. .. .. ..
00b0: .. .. .. .. .. .. .. .. .. 40 0f d4 a0 d3 f3 6a vin0 Witness 1 Length:64 (0x40)
00c0: 1f 10 74 cb 15 83 8a 48 f5 72 dc 18 d4 12 d0 f0
00d0: f0 fc 1e ed a9 fa 48 20 c9 42 ab b7 7e 4d 1a 3c
00e0: 2b 99 cc f4 ad 29 d9 18 9e 6e 04 a0 17 fe 61 17
00f0: 48 46 44 49 f6 81 bc 38 cf 39 .. .. .. .. .. ..
00f0: .. .. .. .. .. .. .. .. .. .. 44 20 fe be 58 3f vin0 Witness 2 Length:68 (0x44)
0100: a7 7e 49 08 9f 89 b7 8f a8 c1 16 71 07 15 d6 e4
0110: 0c c5 f5 a0 75 ef 16 81 55 0d d3 c4 ad 20 d0 fa
0120: 46 cb 88 3e 94 0a c3 dc 54 21 f0 5b 03 85 99 72
0130: 63 9f 51 ed 2e cc bf 3d c5 a6 2e 2e 1b 15 ac ..
0130: .. .. .. .. .. .. .. .. .. .. .. .. .. .. .. 41 vin0 Witness 3 Length:65 (0x41)
0140: c0 2e 44 c9 e4 7e ae b4 bb 31 3a de cd 11 01 2d
0150: fa d4 35 cd 72 ce 71 f5 25 32 9f 24 d7 5c 5b 94
0160: 32 77 4e 14 8e 92 09 ba f3 f1 65 6a 46 98 6d 5f
0170: 38 dd f4 e2 09 12 c6 ac 28 f4 8d 6b f7 47 46 9f
0180: b1
</pre></td></tr></tbody></table></code></div>            </div>

            <p>这个 Witness 中一共有 4 个元素。Witness 最后一个元素是 control block：</p>

            <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>c0                                                               # leaf version and parity bit
2e44c9e47eaeb4bb313adecd11012dfad435cd72ce71f525329f24d75c5b9432 # internal key P
774e148e9209baf3f1656a46986d5f38ddf4e20912c6ac28f48d6bf747469fb1 # hash e
</pre></td></tr></tbody></table></code></div>            </div>

            <p>Witness 倒数第二个元素是 Script：</p>

            <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>20febe583fa77e49089f89b78fa8c116710715d6e40cc5f5a075ef1681550dd3c4ad20d0fa46cb883e940ac3dc5421f05b03859972639f51ed2eccbf3dc5a62e2e1b15ac
      
# 对应 Script：
febe583fa77e49089f89b78fa8c116710715d6e40cc5f5a075ef1681550dd3c4 OP_CHECKSIGVERIFY d0fa46cb883e940ac3dc5421f05b03859972639f51ed2eccbf3dc5a62e2e1b15 OP_CHECKSIG
</pre></td></tr></tbody></table></code></div>            </div>

            <p>Witness 倒数第二个元素之前的所有元素都是“Script 的参数”，在这个 2-of-2 多签的例子中，是两个 Schnorr 签名。</p>

            <p>如何校验这个 Witness 是合法的呢？具体规则在 <a href="https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki#script-validation-rules">BIP341</a> 中，简单地总结有两点：</p>

            <ol>
              <li>检查 Script 确实在 MAST 上；</li>
              <li>脚本 Script 执行完成后，检查栈上留下 True。</li>
            </ol>

            <p>这个 2-of-2 多签例子中，脚本为 <code class="language-plaintext highlighter-rouge">&lt;P1&gt; OP_CHECKSIGVERIFY &lt;P2&gt; OP_CHECKSIG</code>，输入参数是 <code class="language-plaintext highlighter-rouge">[sig(P2), sig(P1)]</code>，只要签名是正确的，则执行完成后，栈上留下的就是 True。</p>

            <details> 
    <summary>Control Block</summary>
    下面再举例说明一下 Control Block。对于下图所示的 MAST，其中一共有 5 个叶子节点（即 5 个脚本），如果花费这个 P2TR 时，想使用脚本 D，除公开脚本 D 源码外，只用提供 C/E/AB 三个哈希值就可以证明脚本 D 确实在 MAST 上了。我们并不需要公开其它脚本（即 A/B/C/E）的源码。
    <a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/tree.png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/tree.png" style="zoom: 80%;" loading="lazy"></a>
    完整的 Control Block 如下：
    <pre><code> 
    &lt;control byte with leaf version and parity bit&gt; &lt;internal key P&gt; &lt;C&gt; &lt;E&gt; &lt;AB&gt;
    </code></pre>
</details>

            <p>铭文数据实际上存储在 P2TR（Script Path）的 Witness 中，后文会详细讲解。</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>BIP 342</strong> 对比特币的脚本语言进行了修改，使比特币的脚本系统与 BIP 340 和 BIP 341 中的所有更新兼容，能够读取 Schnorr 签名。此外，在升级前，比特币脚本的大小被限制为 10000 字节，可以在比特币代码中看到：<a href="https://github.com/bitcoin/bitcoin/blob/v0.17.0/src/script/interpreter.cpp#L299-L300">参考1</a> <a href="https://github.com/bitcoin/bitcoin/blob/v0.17.0/src/script/script.h#L31-L32">参考2</a></p>

    <div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1">// Maximum script length in bytes</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_SCRIPT_SIZE</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">script</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">MAX_SCRIPT_SIZE</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">set_error</span><span class="p">(</span><span class="n">serror</span><span class="p">,</span> <span class="n">SCRIPT_ERR_SCRIPT_SIZE</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>BIP 342 中将这一限制移除了，脚本长度仅隐式地受区块权重大小限制，相当于约 4 MB 的大小。</p>
  </li>
</ul>

<p>SegWit 与 Taproot 两次升级，让比特币具有了更好的可扩展性和隐私性，同时，升级带来的限制较少、价格低廉的链上数据存储空间也使铭文的诞生成为可能。</p>

<h2 id="4-ordinal-theory"><span class="me-2">4 Ordinal Theory</span><a href="#4-ordinal-theory" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>2022 年 12 ⽉，Casey Rodarmor 提出了<strong>序数理论</strong>（Ordinal Theory），包括序数和铭文两个部分。</p>

<h3 id="41-序数"><span class="me-2">4.1 序数</span><a href="#41-序数" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>比特币以“聪”（satoshi）为最小计价单位，1 比特币等于 $10^8$ 聪。比特币是同质、可互换的，也就是说比特币之间是没有任何区别的。而序数理论，就是通过一套额外定义的编号方案，对从创世区块开始，网络上所有被创建和转移的“聪”进行编号，赋予每个“聪”一个编号，使其被唯一标识出来，该编号由聪的挖掘顺序确定，在转账过程中，该编号遵循“先进先出”的顺序。由于编号和转移方案都依赖于顺序，因此得名 Ordinal “序数”。</p>

<p>以上描述使用了序数理论中的说法，但值得注意的是，实际的比特币实现中，并不存在“聪”这一实体，“聪”仅是比特币最小计价单位的名称，不应当认为是聪“构成”了比特币，或比特币“包含”聪。因此，序数理论及其拥护者使用的“一个聪”、“每个聪”等说法是不准确的，正如我们不会对长度单位用“每个米”、或者对质量单位用“一个克”这样的说法一样。另外，每一笔比特币交易本质上都只是对 UTXO 的销毁与创建，这一过程中并不存在一个不变的“聪”的转移，序数理论仅仅是在其独立于比特币协议的方案层面“规定”了销毁和新建的 UTXO 存在序号上的联系，比特币协议并没有正式承认这种编号方式。</p>

<p>序数理论不需要单独的代币、另一个区块链或对比特币的任何更改。它现在就可以工作。</p>

<p>比特币总量是 2100 万个，每个比特币包含 $10^8$ 个聪。因此，比特币网络上⼀共有 2100 万亿个聪。序数将这些聪区分出来，为每个聪进行唯⼀编号，编号根据它们被开采的顺序而定。</p>

<p><strong>表示</strong></p>

<ul>
  <li>整数符号：例如 2099994106992659 。表示该聪按照挖掘顺序所分配的序号。</li>
  <li>⼗进制符号：例如 3891094.16797 。第⼀个数字表示挖掘该聪的区块⾼度，第⼆个数字表示聪在区块中的偏移量。</li>
  <li>度数符号：例如 3°111094′214″16797‴ 。第⼀个数字是周期，从0开始编号；第⼆个数字是减半纪元的区块索引；第三个数字是难度调整期间的区块索引；最后⼀个数字是聪在区块中的偏移量。</li>
  <li>百分比符号：例如 99.99971949060254% 。表示该聪在比特币供应量中的位置，以百分比表示。</li>
  <li>名称：例如 Satoshi 。使用字符 a 到 z 对序号进行编码的名称。</li>
</ul>

<p><strong>转移</strong></p>

<p>假设用户 A 通过挖矿获得了第 100-109 个聪，这 10 个聪存放在同⼀个 id 为 abc123 的 UTXO 中。当 A 要支付给用户 B 5 个聪时，使用 abc123 作为交易输入，其中 5 个聪发送给 B，5 个聪作为找零返回给 A。这两份 “5个聪”都是⼀个整体，分别存放在 id 为 abc456 和 abc789 的 UTXO 中。在上述交易中，聪的流转路径为：</p>

<ol>
  <li>
    <p>挖矿产⽣ 10 个聪，编号是 [100, 110)，存放在 id 为 abc123 的 UTXO 中。</p>
  </li>
  <li>A 进行转账，10 个聪分成两份，每份 5 个聪。根据序数“<strong>先进先出</strong>”的原则，聪的编号排序是按照它们在交易输出中的索引决定的。假设输出的顺序先是 A，然后是 B，那么：
    <ul>
      <li>A 剩余5个聪的序号是 [100, 105)，存放在 id为 abc456 的 UTXO 中；</li>
      <li>B 的 5 个聪的序号是 [105, 110)，存放在 id 为 abc789 的 UTXO 中。</li>
    </ul>
  </li>
  <li>
    <p>如果后续 A 要再进行转账，比如转账给 C，流程也和上述过程类似。</p>

    <p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/640.png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/640.png" style="zoom: 80%;" loading="lazy"></a>
<em>图6 聪的转账过程</em></p>

    <p><strong>稀有度</strong></p>
  </li>
</ol>

<p>聪的稀有度可以根据挖掘顺序来定义。以下是不同聪的稀有程度：</p>

<center>表4 聪的稀有度说明</center>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center">稀有度</th>
      <th style="text-align: center">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">common</td>
      <td style="text-align: center">除区块第⼀个聪外的任何聪（总供应量为 2100 万亿）</td>
    </tr>
    <tr>
      <td style="text-align: center">uncommon</td>
      <td style="text-align: center">每个区块的第⼀个聪（总供应量为 6929999）</td>
    </tr>
    <tr>
      <td style="text-align: center">rare</td>
      <td style="text-align: center">每个难度调整期的第⼀个聪（总供应量为3437）</td>
    </tr>
    <tr>
      <td style="text-align: center">epic</td>
      <td style="text-align: center">每次减半后的第⼀个聪（总供应量为 32）</td>
    </tr>
    <tr>
      <td style="text-align: center">legendary</td>
      <td style="text-align: center">每个周期的第⼀个聪（总供应量为 5）</td>
    </tr>
    <tr>
      <td style="text-align: center">mythic</td>
      <td style="text-align: center">创世区块的第⼀个聪（总供应量为 1）</td>
    </tr>
  </tbody>
</table></div>

<p>不同稀有度的聪在市场上具有不同的价值，能吸引潜在的收藏者和投资者。</p>

<h3 id="42-铭文"><span class="me-2">4.2 铭文</span><a href="#42-铭文" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>单个聪可以刻有任意内容，创建独特的比特币原⽣的数字文物（Digital Artifact），也称为铭文（Inscription）。铭文可以保存在比特币钱包中并使用比特币交易进行传输，与比特币本身⼀样持久、安全。</p>

<p>铭文内容模型类似于网络内容模型。一条铭文由内容类型（也称为 MIME 类型）和内容本身组成，后者是一个字节串。这使得铭文内容可以从Web服务器返回，并用于创建 HTML 铭文，这些铭文可以使用其他铭文的内容。</p>

<p>铭文内容完全存储在链上，在 Taproot 脚本路径花费脚本中存储。Taproot 脚本对其内容的限制非常少，而且还可以获得见证折扣，使得铭文内容存储相对经济。</p>

<p><strong>创建</strong></p>

<p>Taproot 升级中 MAST 的⼀个重要特性是脚本在它被花费之前不会在链上显示。因此，为了让铭文显示在链上，通常需要创建两笔交易：⼀笔 commit 交易用来创建铭文；另⼀笔 reveal 交易花费第⼀笔交易的输出，从而在链上显示脚本信息。具体而言：</p>

<ol>
  <li>⾸先，在 commit 交易中创建⼀个 commit 到包含铭文内容的脚本的 Taproot 输出；存储的格式是Taproot，即前⼀笔交易的输出是 P2TR。</li>
  <li>在 reveal 交易中消费 commit 创建的输出，即通过将那笔铭文对应的 UTXO 作为输入，发起交易。随后，其对应的铭文内容被公开至网络。</li>
</ol>

<p>铭文内容存储在被称为“信封”（Envelope）的结构中，即用<code class="language-plaintext highlighter-rouge">OP_FALSE</code>、<code class="language-plaintext highlighter-rouge">OP_IF</code>…<code class="language-plaintext highlighter-rouge">OP_ENDIF</code>等操作包裹任意数量的铭文数据。由于信封实际上是无操作的，因此不会改变包含脚本的语义，也不会影响正常的交易，且可以与任何其他锁定脚本结合使用。</p>

<p>例如，包含字符串“ Hello, world! ”的文本铭文的序列化如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>OP_FALSE
OP_IF
  OP_PUSH "ord"
  OP_PUSH 1
  OP_PUSH "text/plain;charset=utf-8"
  OP_PUSH 0
  OP_PUSH "Hello, world!"
OP_ENDIF
</pre></td></tr></tbody></table></code></div></div>

<p>首先，将字符串 “ord” 入栈，以避免铭文与信封的其他用途的混淆。<code class="language-plaintext highlighter-rouge">OP_PUSH 1</code> 表示下一个压栈操作包含内容类型，而 <code class="language-plaintext highlighter-rouge">OP_PUSH 0</code> 表示随后的压栈操作包含内容本身。前文提到 Taproot 升级修改了部分脚本资源限制，但升级中保留了脚本元素大小的限制条件，即初始栈和压栈操作符的元素最大为 520 字节：（参考 <a href="https://github.com/bitcoin/bitcoin/blob/master/src/script/script.h#L26C1-L27C57">比特币源码</a>，<a href="https://github.com/bitcoin/bips/blob/master/bip-0342.mediawiki">BIP 342</a>）</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Maximum number of bytes pushable to the stack</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MAX_SCRIPT_ELEMENT_SIZE</span> <span class="o">=</span> <span class="mi">520</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>因此，对于大型铭文，必须进行多次压栈操作。</p>

<p><strong>铭文底层解析</strong></p>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td>为更加清楚地阐释铭文原理，这里以一个实际的铭文交易为例进行说明：[1c5435cd882e98ec5532a5006a8afe313207f18dd54042219ac57587080a80b8]([Transaction: 1c5435cd882e98ec5532a5006a8afe313207f18dd54042219ac57587080a80b8</td>
      <td>Blockchain.com](https://www.blockchain.com/explorer/transactions/btc/1c5435cd882e98ec5532a5006a8afe313207f18dd54042219ac57587080a80b8))</td>
    </tr>
  </tbody>
</table></div>

<p>交易的十六进制数据可由此获得：<a href="https://mempool.space/api/tx/1c5435cd882e98ec5532a5006a8afe313207f18dd54042219ac57587080a80b8/hex">mempool.space (hex)</a></p>

<p>原始数据如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>0100000000010163 a2877c846b01bacb b529de2d2fa45243 2620857e76df70b2 b52dc3b2b2f06300 00000000fdffffff 0110270000000000 00160014311875fd
a80db86117dc560d 43d3dfc63275e4c8 0340d25a9c030e3e f58f42e0de170681 9ae0c70967508c5a 0106d369553fd4f8 12a8565d644cbee3 ed357a4ab146aadf
e02285971e8b4fab 27743f4f85c62a44 8095cc20aa8bd547 3ac0576dfc551b8c 92832b312ad87422 235e82f614c7e66a 752b5627ac006303 6f7264010109696d
6167652f706e6700 4c9489504e470d0a 1a0a0000000d4948 4452000000180000 00180806000000e0 773df80000005b49 44415478da636018 05a30008fee3c194
1bbeae3b1127a6d4 12b841dbe637d1c4 12828653c5024278 705b400226cf7034 57627339f9166033 8caa160c5824e308 be919a4c7105cff0 0922aa95a658d23d
55ea03aaba966616 0000ab897efb3d3f f6f5000000004945 4e44ae4260826821 c1aa8bd5473ac057 6dfc551b8c92832b 312ad87422235e82 f614c7e66a752b56
2700000000
</pre></td></tr></tbody></table></code></div></div>

<p>原始数据的解析如下：</p>

<center>表5 铭文交易原始数据解析</center>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center">十六进制数据</th>
      <th style="text-align: center">类型</th>
      <th style="text-align: center">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">01000000</code></td>
      <td style="text-align: center">uint32</td>
      <td style="text-align: center">版本 1</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">0001</code></td>
      <td style="text-align: center">2  octets</td>
      <td style="text-align: center">见证标识</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">01</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">交易输入数量</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>输入 1</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">63a2877c846b01ba</code> <code class="language-plaintext highlighter-rouge">cbb529de2d2fa452</code> <code class="language-plaintext highlighter-rouge">432620857e76df70</code> <code class="language-plaintext highlighter-rouge">b2b52dc3b2b2f063</code></td>
      <td style="text-align: center">32 octets</td>
      <td style="text-align: center">引用交易的哈希</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">00000000</code></td>
      <td style="text-align: center">uint32</td>
      <td style="text-align: center">先前输出的索引</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">00</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">脚本签名长度 (Segwit 长度为0)</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">fdffffff</code></td>
      <td style="text-align: center">4 octets</td>
      <td style="text-align: center">序列号</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">01</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">交易输出数</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>输出 1</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">1027000000000000</code></td>
      <td style="text-align: center">int64</td>
      <td style="text-align: center">以聪为单位的数量（0.0001 BTC）</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">16</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">脚本长度 (0x16 = 22)</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">0014311875fda80d</code> <code class="language-plaintext highlighter-rouge">b86117dc560d43d3</code> ` dfc63275e4c8`</td>
      <td style="text-align: center">22 octets</td>
      <td style="text-align: center">锁定脚本</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>见证数据</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">03</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">见证数</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>见证部分 1</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">40</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">见证部分长度 (0x40 = 64)</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">d25a9c030e3ef58f</code> <code class="language-plaintext highlighter-rouge">42e0de1706819ae0</code> <code class="language-plaintext highlighter-rouge">c70967508c5a0106</code> <code class="language-plaintext highlighter-rouge">d369553fd4f812a8</code><br /><code class="language-plaintext highlighter-rouge">565d644cbee3ed35</code> <code class="language-plaintext highlighter-rouge">7a4ab146aadfe022</code> <code class="language-plaintext highlighter-rouge">85971e8b4fab2774</code> <code class="language-plaintext highlighter-rouge">3f4f85c62a448095</code></td>
      <td style="text-align: center">64 octets</td>
      <td style="text-align: center">见证数据，从长度可以看出是签名</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>见证部分 2</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">cc</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">见证部分长度 (0xcc = 204)</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">20aa8bd5473ac057</code> <code class="language-plaintext highlighter-rouge">6dfc551b8c92832b</code> <code class="language-plaintext highlighter-rouge">312ad87422235e82 </code> <code class="language-plaintext highlighter-rouge">f614c7e66a752b56 </code><br /><code class="language-plaintext highlighter-rouge">27ac0063036f7264 </code> <code class="language-plaintext highlighter-rouge">010109696d616765 </code> <code class="language-plaintext highlighter-rouge">2f706e67004c9489 </code> <code class="language-plaintext highlighter-rouge">504e470d0a1a0a00  </code> <br /><code class="language-plaintext highlighter-rouge">00000d4948445200 </code> <code class="language-plaintext highlighter-rouge">0000180000001808 </code> <code class="language-plaintext highlighter-rouge">06000000e0773df8 </code> <code class="language-plaintext highlighter-rouge">0000005b49444154 </code><br /><code class="language-plaintext highlighter-rouge">78da63601805a300  </code> <code class="language-plaintext highlighter-rouge">08fee3c1941bbeae </code> <code class="language-plaintext highlighter-rouge">3b1127a6d412b841  </code> <code class="language-plaintext highlighter-rouge">dbe637d1c4128286   </code> <br /><code class="language-plaintext highlighter-rouge">53c5024278705b40  </code> <code class="language-plaintext highlighter-rouge">0226cf7034576273 </code> <code class="language-plaintext highlighter-rouge">39f91660338caa16  </code> <code class="language-plaintext highlighter-rouge">0c5824e308be919a  </code><br /><code class="language-plaintext highlighter-rouge">4c7105cff00922aa   </code> <code class="language-plaintext highlighter-rouge">95a658d23d55ea03  </code> <code class="language-plaintext highlighter-rouge">aaba9666160000ab   </code> <code class="language-plaintext highlighter-rouge">897efb3d3ff6f500 </code><br /><code class="language-plaintext highlighter-rouge">00000049454e44ae   </code> <code class="language-plaintext highlighter-rouge">42608268 </code></td>
      <td style="text-align: center">204 octets</td>
      <td style="text-align: center">见证数据，包含铭文实际数据</td>
    </tr>
    <tr>
      <td style="text-align: center"><strong>见证部分 3</strong></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">21</code></td>
      <td style="text-align: center">varint</td>
      <td style="text-align: center">见证部分长度 (0x21 = 33)</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">c1aa8bd5473ac057</code> <code class="language-plaintext highlighter-rouge">6dfc551b8c92832b</code> <code class="language-plaintext highlighter-rouge">312ad87422235e82</code> <code class="language-plaintext highlighter-rouge">f614c7e66a752b56</code> <code class="language-plaintext highlighter-rouge">27</code></td>
      <td style="text-align: center">33 octets</td>
      <td style="text-align: center">见证数据，长度与公钥一致，P2WPKH</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">00000000</code></td>
      <td style="text-align: center">unit32</td>
      <td style="text-align: center">Lock time 设为 0 表示交易立即传播和执行</td>
    </tr>
  </tbody>
</table></div>

<p>该交易中，见证的第二部分包含了铭文的实际数据，铭文相关的操作码如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>OP_IF          63
OP_FALSE       00
N/A            01-4b
OP_PUSHDATA1   4c
OP_PUSHDATA2   4d
OP_PUSHDATA4   4e
OP_ENDIF       68
</pre></td></tr></tbody></table></code></div></div>

<p>原始数据块长度标识规则：</p>

<ul>
  <li>如果第一个字节小于 <code class="language-plaintext highlighter-rouge">4c</code> 直接用其作为长度，</li>
  <li>如果第一个字节是 <code class="language-plaintext highlighter-rouge">4c</code> 后一字节为长度，</li>
  <li>如果第一个字节是 <code class="language-plaintext highlighter-rouge">4d</code> 后两个字节为长度，</li>
  <li>如果第一个字节是 <code class="language-plaintext highlighter-rouge">4e</code> 后四个字节为长度。</li>
</ul>

<hr />

<p>铭文头/签名 (<code class="language-plaintext highlighter-rouge">OP_IF + len + "ord" + 0101</code>，可以直接搜索这一序列)：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>63 03 6f 72 64 01 01
</pre></td></tr></tbody></table></code></div></div>

<p>Mime 字符串长度：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>09
</pre></td></tr></tbody></table></code></div></div>

<p>Mime 文本 (ASCII)：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>69 6d 61 67 65 2f 70 6e 67
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">OP_FALSE</code> (将 Mime 和数据分开):</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>00
</pre></td></tr></tbody></table></code></div></div>

<p>数据块长度 (0x94 = 148)：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>4c 94
</pre></td></tr></tbody></table></code></div></div>

<p>数据块内容：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>89 50 4e 47 0d 0a 1a 0a 00 00 00 0d 49 48 44 52 00 00 00 18
00 00 00 18 08 06 00 00 00 e0 77 3d f8 00 00 00 5b 49 44 41
54 78 da 63 60 18 05 a3 00 08 fe e3 c1 94 1b be ae 3b 11 27
a6 d4 12 b8 41 db e6 37 d1 c4 12 82 86 53 c5 02 42 78 70 5b
40 02 26 cf 70 34 57 62 73 39 f9 16 60 33 8c aa 16 0c 58 24
e3 08 be 91 9a 4c 71 05 cf f0 09 22 aa 95 a6 58 d2 3d 55 ea
03 aa ba 96 66 16 00 00 ab 89 7e fb 3d 3f f6 f5 00 00 00 00
49 45 4e 44 ae 42 60 82
</pre></td></tr></tbody></table></code></div></div>

<p><em>(铭文中可能有多个数据块需要拼接，此例中只有一个)</em></p>

<p><code class="language-plaintext highlighter-rouge">OP_ENDIF</code> (标识铭文结束):</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>68
</pre></td></tr></tbody></table></code></div></div>

<p>接下来在浏览器控制台中用几行 JS 代码即可还原铭文数据</p>

<p>首先创建一个用于将十六进制字符串转换为字节数组的辅助函数：</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>  <span class="kd">const</span> <span class="nx">toBytes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hex</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nb">Uint8Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">hex</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/.</span><span class="se">{1,2}</span><span class="sr">/g</span><span class="p">).</span><span class="nf">map</span><span class="p">((</span><span class="nx">byte</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">byte</span><span class="p">,</span> <span class="mi">16</span><span class="p">)));</span>
</pre></td></tr></tbody></table></code></div></div>

<p>解码 Mime 类型，得到 ` image/png` ：</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>  <span class="kd">const</span> <span class="nx">mime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TextDecoder</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="nf">toBytes</span><span class="p">(</span><span class="dl">'</span><span class="s1">696d6167652f706e67</span><span class="dl">'</span><span class="p">))</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">mime</span><span class="p">)</span> 
</pre></td></tr></tbody></table></code></div></div>

<p>获取文件字节流数据：</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nf">toBytes</span><span class="p">(</span><span class="dl">'</span><span class="s1">89504e470d0a1a0a0000000d4948445200000018000000180806000000e0773df80000005b4944415478da63601805a30008fee3c1941bbeae3b1127a6d412b841dbe637d1c412828653c5024278705b400226cf703457627339f91660338caa160c5824e308be919a4c7105cff00922aa95a658d23d55ea03aaba9666160000ab897efb3d3ff6f50000000049454e44ae426082</span><span class="dl">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>最后重建文件并在浏览器中打开：</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>  <span class="kd">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="p">([</span><span class="nx">data</span><span class="p">],</span> <span class="dl">'</span><span class="s1">myFile</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nx">mime</span><span class="p">})</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nf">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
  <span class="nf">open</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>下图就是铭文中铭刻的内容了，是一张 24 x 24，大小 148 字节 的图片：</p>

<p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/7ebe9c69-c459-4c99-9df4-631b824ef36b.png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/7ebe9c69-c459-4c99-9df4-631b824ef36b.png" style="zoom:500%;" loading="lazy"></a>
<em>图7 铭文中的图片</em></p>

<h2 id="5-brc-20"><span class="me-2">5 BRC-20</span><a href="#5-brc-20" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>BRC-20 代币标准是由匿名开发者 domo（@domodata）于 2023 年 3 月 8 日创建的。该标准借助铭文功能实验性地在比特币上创建同质化代币。“BRC-20”名字借鉴于以太坊 ERC-20 代币标准。</p>

<p>BRC-20 代币通过在比特币铭文里存储 JSON 代码数据进行代币记账，目前仅有部署、铸造和转帐三种功能，不具备以太坊上图灵完备的智能合约功能。BRC-20 代币每⼀次部署、铸造和转移都产⽣⼀个新的铭文，因此每次操作都需要 commit 和 reveal 两次交易。</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
  <span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">brc-20</span><span class="dl">"</span><span class="p">,</span>     <span class="c1">// Protocol: 帮助线下的记账系统识别和处理BRC-20事件</span>
  <span class="dl">"</span><span class="s2">op</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">deploy</span><span class="dl">"</span><span class="p">,</span>    <span class="c1">// Operation: 事件类型 (Deploy, Mint, Transfer)</span>
  <span class="dl">"</span><span class="s2">tick</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ordi</span><span class="dl">"</span><span class="p">,</span>    <span class="c1">// Ticker: brc-20代币的标识符，⻓度为4个字⺟（可以是emoji）</span>
  <span class="dl">"</span><span class="s2">max</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">21000000</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// Max supply: brc-20代币的最大供应量</span>
  <span class="dl">"</span><span class="s2">lim</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1000</span><span class="dl">"</span>      <span class="c1">// Mint limit: 每次brc-20代币铸造量的限制</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>尽管根据其提出者的说法，这仅是一个对可互换性的实验性标准，但 BRC-20 如今已在比特币社区内引起了极大的关注，人们纷纷开始创建自己的 BRC-20 代币。同时，像钱包服务和市场等序数基础设施提供商，已经开始集成 BRC-20，以使其用户能够铸造和交换 BRC-20 代币。</p>

<p>目前比较火热的 BRC-20 代币项目有：</p>

<ul>
  <li>
    <p><strong>$ORDI</strong>：比特币上的⾸个 BRC-20 代币，利用 Ordinals 协议在聪上刻录信息。ORDI 拥有 2100 万枚硬币的限量供应，为 NFT 和代币引入了创新的可能性，根据挖掘和转移顺序分配序数。</p>
  </li>
  <li>
    <p><strong>$SATS</strong>：将比特币区块链上的最小单位聪转化为⼀个可交易和可收藏的代币，总量与比特币相同，每个 SATS都有⼀个唯⼀的序号。SATS 是 BRC-20 目前拥有持币地址最多的项目。</p>
  </li>
  <li>
    <p><strong>$MUBI</strong>：MultiBit 是首个为 BRC-20 与 ERC-20 代币间的跨网络转移的双向跨链桥。通过促进这些代币更便捷的流动性，MultiBit 加强了跨链互操作性，目的是以安全和用户友好的方式，促进 BRC 和 ERC 代币的流动性和可访问性。</p>
  </li>
</ul>

<p><strong>局限性</strong></p>

<p>虽然 BRC-20 代币被称作同质化代币，但由于其基于铭文实现，只能以设定的增量进行交易，因此实质上更接近半同质化代币。用户需要创建铸币 JSON 铭文来定义要铸造数量，然后通过交易手续费拍卖与其他人竞争优先权，以最终完成铸币。为了在比特币网络上以原生方式交易 BRC-20 代币，卖方需要创建转账铭文，将原始铸币铭文分割成更小的块，以便能出售预定义批次的代币。如果想购买特定数量的 BRC-20 代币，买方必须找到愿意出售该数量代币的卖方。另外，要确定钱包中 BRC-20 代币的余额，仅依靠比特币全节点是不够的，用户还需要自己运行或信任第三方的链下索引器，由索引器通过规则集解析铭文。需要注意的是，这种中心化的索引方式具有极高的共识风险，若不同交易平台或交易双方使用不同的索引器，那么 BRC-20 代币的所有权可能产生分歧。</p>

<p><strong>相较于 ERC-20</strong></p>

<p>其实 BRC-20 与 ERC-20 之间的可比性基本仅限于名称。ERC-20 是以太坊上基于智能合约的同质化代币标准，而 BRC-20 是在比特币上基于序数铭文创建半同质化代币的一种方式。由于比特币有意限制了可编程性，目前 BRC-20 代币基本没有实际功能，比 ERC-20 简单、局限性更多。同时 BRC-20 代币的流动性也更差。</p>

<p><strong>影响</strong></p>

<p>序数、铭文、BRC-20 等新叙事一方面为比特币吸引了注意力，使比特币网络活跃程度明显上升，另一方面则加重了网络拥堵，交易手续费大幅提升。以下是几个关键指标：</p>

<ol>
  <li>
    <p>内存池</p>

    <p>2023 年 2 月 至 2024 年 1 月间，比特币内存池容量显著增长，目前已接近 600 MvB。</p>

    <p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/mempool-graph-1y-1706428810.svg" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/mempool-graph-1y-1706428810.svg" style="zoom: 80%;" loading="lazy"></a>
<em>图8 2023.2-2024.1 比特币内存池容量变化</em></p>

    <p>目前，交易的阈值费率已经来到了 22.3 sat/vB，也就是说手续费低于该费率标准的交易将被内存池满的比特币节点直接拒绝。当前内存占用达 1.62GB，远高于 Bitcoin Core 默认分配的 300 MB 内存，未确认的交易多达 27 万笔。</p>

    <p><a href="https://fanwb.oss-cn-beijing.aliyuncs.com/img/1706431251765.png" class="popup img-link  shimmer"><img src="https://fanwb.oss-cn-beijing.aliyuncs.com/img/1706431251765.png" loading="lazy"></a>
<em>图9 交易阈值费率/内存占用/未确认交易数</em></p>
  </li>
  <li>
    <p>平均手续费</p>

    <p>由下图可以看出，比特币交易平均手续费明显上升，峰值超过 30 美金，较 2023 年初提升超 30 倍。</p>

    <iframe width="100%" height="420" frameborder="0" src="https://www.theblock.co/data/on-chain-metrics/bitcoin/average-transaction-fee-on-bitcoin-7dma/embed" title="Average Transaction Fee on Bitcoin (7DMA)"></iframe>
    <center>图10 比特币交易平均手续费变化</center>

    <ol>
      <li>
        <p>搜索量</p>

        <p>2023 年全年中“Bitcoin”的谷歌搜索量显著高于“Ethereum”、“Coinbase”、“NFT”等词条，且呈现明显的上升趋势。侧面反映了铭文和 BRC-20 为比特币生态吸引了更多关注。</p>

        <iframe width="100%" height="420" frameborder="0" src="https://www.theblock.co/data/alternative-crypto-metrics/web-traffic/google-search-volumes/embed" title="Google Search Volumes"></iframe>
      </li>
    </ol>
    <center>图11 "Bitcoin"词条的谷歌搜索量变化</center>
  </li>
</ol>

<p>值得一提的是，比特币社区中对序数铭文、BRC-20 等新叙事看法仍不统一，这也反映在了对上述指标的解读上：</p>

<ul>
  <li>
    <p>铭文、BRC-20的拥护者认为，序数和铭文能够拓展比特币的应用场景，吸引更多的开发者和用户，同时提升比特币网络的活跃度。他们倾向于正面解读交易手续费的大幅上涨，认为随着交易量增加和交易费用上升，比特币矿⼯的收益更能得到保障，从而吸引更多算力加入比特币网络，使得比特币网络更加安全、健壮和去中心化。这方认为上涨的手续费是比特币网络不可或缺的“安全预算”。另外，他们提出可以通过建设闪电网络等二层扩展方案来解决交易手续费高企的问题。</p>
  </li>
  <li>
    <p>而比特币原教旨主义者、铭文和 BRC-20 的反对者认为这类应用是对 Taproot 升级的滥用，随着类似的应用的增多，比特币网络可能被阻塞，影响比特币的转账甚至出块，带来“劣币驱逐良币”的效应，违背比特币最初成为“点对点电子现金”、数字硬通货的初衷，即便二层扩展能够一定程度缓解手续费的问题，也不能成为毫无价值的 BRC-20 挤占算力资源的理由。比特币常被认为是“数字黄金”，而这方认为“金子就该是纯粹的，不应掺入其他杂质”。比特币核心开发者 Luke Dash Jr.（@LukeDashjr）称铭文是在利用 Bitcoin Core 的漏洞，并提到“这个漏洞最近在 Bitcoin Knots v25.1 中得到了修复， Bitcoin Core 在即将发布的 v26 版本中仍然存在漏洞。我只能希望它将在明年的 v27 版本之前最终得到修复。”</p>

    <blockquote class="twitter-tweet"><p lang="en" dir="ltr">PSA: “Inscriptions” are exploiting a vulnerability in <a href="https://twitter.com/hashtag/Bitcoin?src=hash&amp;ref_src=twsrc%5Etfw">#Bitcoin</a> Core to spam the blockchain. Bitcoin Core has, since 2013, allowed users to set a limit on the size of extra data in transactions they relay or mine (`-datacarriersize`). By obfuscating their data as program code,…</p>&mdash; Luke Dashjr (@LukeDashjr) <a href="https://twitter.com/LukeDashjr/status/1732204937466032285?ref_src=twsrc%5Etfw">December 6, 2023</a></blockquote>
    <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </li>
</ul>

<h2 id="6-总结"><span class="me-2">6 总结</span><a href="#6-总结" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>本文深入最底层，详细介绍了比特币序数理论、铭文和 BRC-20 代币相关的技术知识。以 Colored Coin 为先驱，经过 SegWit 和 Taproot 两次升级，比特币交易拥有了更大的存储空间、能支持更复杂的脚本。随之而来的序数理论，提出了对“聪”进行排序标记的方法，而铭文则基于此定义了一套编码规则将网络媒体内容存储在链上。BRC-20 标准基于序数理论和铭文，通过将账本铭刻在聪上实现了在比特币上发行同质化代币。当前，比特币社区中对于铭文、BRC-20 价值的讨论仍莫衷一是，这一系列新叙事究竟是颠覆比特币生态的革新者，还是昙花一现的投机客，我们仍需拭目以待。不过这样的讨论本身，倒是很好地彰显了去中心化的 Web3 世界所独有的魅力。</p>

<hr />

<p><strong>参考</strong></p>

<p>[1] <a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki">BIP 340</a></p>

<p>[2] <a href="https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki">BIP 341</a></p>

<p>[3] <a href="https://github.com/bitcoin/bips/blob/master/bip-0342.mediawiki">BIP 342</a></p>

<p>[4] <a href="https://docs.ordinals.com/introduction.html">Ordinal Theory</a></p>

<p>[5] <a href="https://layer1.gitbook.io/layer1-foundation/protocols/brc-20/documentation">BRC-20 docs</a></p>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/blockchain/">Blockchain</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/bitcoin/"
            class="post-tag no-text-decoration"
          >bitcoin</a>
        
          <a
            href="/tags/inscription/"
            class="post-tag no-text-decoration"
          >inscription</a>
        
          <a
            href="/tags/ordinals/"
            class="post-tag no-text-decoration"
          >ordinals</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Ordinals%20&%20BRC-20%20%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%20-%20Fanwb's%20Blog&url=https%3A%2F%2Ffan-wb.github.io%2Fposts%2Fordinals%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Ordinals%20&%20BRC-20%20%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%20-%20Fanwb's%20Blog&u=https%3A%2F%2Ffan-wb.github.io%2Fposts%2Fordinals%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Ffan-wb.github.io%2Fposts%2Fordinals%2F&text=Ordinals%20&%20BRC-20%20%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%20-%20Fanwb's%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/stablecoin/">稳定币：金融生态的跨界之桥</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/aa/">账户抽象架构设计详解</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/lmdghost/">以太坊 PoS 共识协议详解（一）：核心概念与 LMD GHOST</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/rwa/">RWA 代币化浪潮：万物皆可加密</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/aicrypto/">AI × 加密：去中心化愿景的现实考验</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ethereum/">ethereum</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/consensus/">consensus</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/privacy/">privacy</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rollup/">rollup</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blockchain/">blockchain</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/defi/">defi</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ipfs/">ipfs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pos/">pos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rwa/">rwa</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/account-abstraction/">account abstraction</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/zkevmrollup/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1676865600"
  data-df="ll"
  
>
  Feb 20, 2023
</time>

              <h4 class="pt-0 my-2">zkEVM Rollup：从理论到现实</h4>
              <div class="text-muted">
                <p>
                  





                  为了解决区块链Layer 1网络的扩容问题，Rollup方案应运而生。结合零知识（ZK）技术，ZK Rollup成为Layer 2赛道中备受瞩目的解决方案。然而，对于大多数人而言，ZK、Rollup和EVM等相关概念可能有一定的理解难度。因此，本份研报的目标是用简洁易懂的语言，对zkEVM Rollup的一系列概念进行系统梳理，深入分析zkEVM Rollup技术的发展和现状，并详细解读其中...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/lmdghost/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1681531200"
  data-df="ll"
  
>
  Apr 15, 2023
</time>

              <h4 class="pt-0 my-2">以太坊 PoS 共识协议详解（一）：核心概念与 LMD GHOST</h4>
              <div class="text-muted">
                <p>
                  





                  本文是介绍以太坊 PoS 共识协议的第一部分。主要包括对术语和核心概念的讲解，以及对 LMD GHOST 分叉选择规则的详细介绍。

术语及重要概念

节点和验证者

以太坊网络的主要参与者是节点 (Node)。节点的作用是验证共识并与其他节点形成通信骨干网。共识由验证者 (Validator) 形成。


  “验证者”这一术语具有一定的误导性，验证者其实并不会验证任何东西，验证是由节点完...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/casperffg/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1684641600"
  data-df="ll"
  
>
  May 21, 2023
</time>

              <h4 class="pt-0 my-2">以太坊 PoS 共识协议详解（二）：Casper FFG</h4>
              <div class="text-muted">
                <p>
                  





                  本文是介绍以太坊 PoS 共识协议的第二部分，主要对最终性工具 Casper FFG 进行全面说明。

许多文章都介绍过 Casper FFG 的运行机制，但很少解释这些机制为什么有效。希望本文能为读者理解 Casper FFG 的有效性提供一些参考。

总体而言，Casper FFG 的机制并不复杂，其有效性主要归功于为两个重要理念：两阶段提交，以及可问责安全性。

两阶段提交赋予了 Ca...
                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/aa/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>账户抽象架构设计详解</p>
    </a>
  

  
    <a
      href="/posts/modular/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>拆分与重构：模块化架构下的区块链新生态</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'fan-wb/fan-wb.github.io',
      'data-repo-id': 'R_kgDOIpbGbQ',
      'data-category': 'Announcements',
      'data-category-id': 'DIC_kwDOIpbGbc4CimRo',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'top',
      'data-lang': 'zh-CN',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2024</time>

    
      <a href="https://github.com/fan-wb">Fan-WB</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title=""
      ><a href='https://beian.miit.gov.cn/' target='_blank'>京ICP备2024091746号-1</a></span>
    
  </p>

  <p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ethereum/">ethereum</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/consensus/">consensus</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/privacy/">privacy</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rollup/">rollup</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blockchain/">blockchain</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/defi/">defi</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ipfs/">ipfs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pos/">pos</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rwa/">rwa</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/account-abstraction/">account abstraction</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->




  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script>
    /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */
    MathJax = {
      tex: {
        /* start/end delimiter pairs for in-line math */
        inlineMath: [
          ['$', '$'],
          ['\\(', '\\)']
        ],
        /* start/end delimiter pairs for display math */
        displayMath: [
          ['$$', '$$'],
          ['\\[', '\\]']
        ],
        /* equation numbering */
        tags: 'ams'
      }
    };
  </script>
  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>





    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

